<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="CRK2 Events">
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#6366f1">
    <meta name="description" content="Aplicaci√≥n interactiva para personalizaci√≥n de productos en eventos">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- iOS Espec√≠fico -->

    <title>Personaliza tu Producto - CRK2</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            -webkit-user-select: none;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        /* Pantalla de Bienvenida */
        #welcome-screen {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            cursor: pointer;
        }

        /* Overlay oscuro para mejor legibilidad */
        #welcome-screen::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.35);
            z-index: 1;
        }

        /* Logo del evento */
        .event-logo {
            position: absolute;
            top: 2.5rem;
            left: 50%;
            transform: translateX(-50%);
            max-width: 180px;
            max-height: 90px;
            object-fit: contain;
            z-index: 10;
            filter: drop-shadow(0 4px 12px rgba(0, 0, 0, 0.3));
            animation: fadeInDown 1s ease-out;
        }

        /* Instrucci√≥n opcional */
        .instruction-text {
            position: absolute;
            bottom: 3rem;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
            color: white;
            font-size: 1.125rem;
            font-weight: 600;
            text-align: center;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.6);
            animation: fadeIn 1.5s ease-out;
            opacity: 0.95;
            max-width: 90%;
            pointer-events: none;
        }

        /* Pantalla de error (si no est√° configurado) */
        #error-screen {
            display: none;
            width: 100%;
            height: 100%;
            background: #f8f9fa;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            text-align: center;
        }

        #error-screen.active {
            display: flex;
        }

        .error-content {
            background: white;
            padding: 2.5rem;
            border-radius: 1.5rem;
            max-width: 500px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(0, 0, 0, 0.08);
        }

        .error-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
        }

        .error-title {
            font-size: 1.75rem;
            font-weight: 700;
            color: #1d1d1f;
            margin-bottom: 1rem;
            letter-spacing: -0.02em;
        }

        .error-message {
            font-size: 1rem;
            color: #6e6e73;
            margin-bottom: 2rem;
            line-height: 1.6;
        }

        .error-button {
            padding: 1rem 2rem;
            background: #6366f1;
            color: white;
            border: none;
            border-radius: 0.75rem;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }

        .error-button:hover {
            background: #4f46e5;
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(99, 102, 241, 0.4);
        }

        /* Animaciones */
        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 0.95;
            }
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }

        /* Efecto de transici√≥n al hacer click */
        .transition-out {
            animation: fadeOut 0.4s ease-out forwards;
        }

        @keyframes fadeOut {
            from {
                opacity: 1;
            }
            to {
                opacity: 0;
            }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .event-logo {
                max-width: 140px;
                max-height: 70px;
                top: 2rem;
            }

            .instruction-text {
                font-size: 1rem;
                bottom: 2.5rem;
            }
        }

        @media (max-height: 700px) {
            .event-logo {
                top: 1.5rem;
                max-width: 130px;
            }
        }

        /* Landscape mode */
        @media (orientation: landscape) and (max-height: 500px) {
            .event-logo {
                max-width: 100px;
                max-height: 50px;
                top: 1rem;
            }

            .instruction-text {
                bottom: 1.25rem;
                font-size: 0.875rem;
            }
        }

        #event-logo {
            display: none !important;
        }

        /* Demo: Simular diferentes fondos */
        .demo-controls {
            position: fixed;
            top: 1rem;
            right: 1rem;
            z-index: 100;
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            max-width: 300px;
        }

        .demo-button {
            padding: 0.5rem 1rem;
            background: white;
            border: 1px solid #ddd;
            border-radius: 0.5rem;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .demo-button:hover {
            background: #f0f0f0;
        }
        #event-logo {
            display: none !important;
        }

    </style>
</head>
<body>

    <!-- Pantalla de Bienvenida -->
    <div id="welcome-screen">
        <img id="event-logo" class="event-logo" style="display: none;" alt="Logo del evento">
        
    </div>

    <!-- Pantalla de Error (si no est√° configurado) -->
    <div id="error-screen">
        <div class="error-content">
            <div class="error-icon">‚ö†Ô∏è</div>
            <h1 class="error-title">Evento No Configurado</h1>
            <p class="error-message">
                El organizador a√∫n no ha configurado este evento. 
                Por favor, contacta al personal del evento o intenta m√°s tarde.
            </p>
            <button class="error-button" onclick="location.reload()">
                Intentar de Nuevo
            </button>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/config-manager.js"></script>
    <script src="js/sw-register.js"></script>
    <script>
        // Inicializar pantalla de bienvenida
        document.addEventListener('DOMContentLoaded', () => {
            const welcomeScreen = document.getElementById('welcome-screen');
            const errorScreen = document.getElementById('error-screen');
            const eventLogo = document.getElementById('event-logo');

            console.log('üîç === INICIANDO VERIFICACI√ìN EN INDEX.HTML ===');
            
            // LEER DIRECTAMENTE DE LOCALSTORAGE
            const configRaw = localStorage.getItem('crk2_event_config');
            const configuredFlag = localStorage.getItem('crk2_event_configured');
            
            console.log('1Ô∏è‚É£ Config JSON completo:', configRaw ? configRaw.substring(0, 200) + '...' : 'NULL');
            console.log('2Ô∏è‚É£ Flag configurado:', configuredFlag);
            
            // Intentar parsear
            let config = null;
            let parseError = false;
            
            try {
                if (configRaw) {
                    config = JSON.parse(configRaw);
                    console.log('3Ô∏è‚É£ Config parseado exitosamente');
                    console.log('   - welcomeBackground existe:', !!config.welcomeBackground);
                    console.log('   - products length:', config.products ? config.products.length : 0);
                    console.log('   - configured flag en config:', config.configured);
                } else {
                    console.log('3Ô∏è‚É£ ‚ùå No hay config en localStorage');
                }
            } catch (e) {
                console.error('3Ô∏è‚É£ ‚ùå Error al parsear config:', e);
                parseError = true;
            }

            // VERIFICACI√ìN DIRECTA Y SIMPLE
            const hasBackground = config && config.welcomeBackground && config.welcomeBackground.length > 0;
            const hasProducts = config && Array.isArray(config.products) && config.products.length > 0;
            const flagIsTrue = configuredFlag === 'true';
            const configFlagIsTrue = config && config.configured === true;
            
            console.log('4Ô∏è‚É£ Verificaciones:');
            console.log('   - hasBackground:', hasBackground);
            console.log('   - hasProducts:', hasProducts);
            console.log('   - localStorage flag:', flagIsTrue);
            console.log('   - config.configured:', configFlagIsTrue);
            
            // L√ìGICA FINAL
            const isConfigured = !parseError && hasBackground && hasProducts && (flagIsTrue || configFlagIsTrue);
            
            console.log('5Ô∏è‚É£ RESULTADO FINAL: isConfigured =', isConfigured);

            if (!isConfigured) {
                console.log('‚ùå MOSTRANDO PANTALLA DE ERROR');
                welcomeScreen.style.display = 'none';
                errorScreen.classList.add('active');
                return;
            }

            console.log('‚úÖ CONFIGURADO - Mostrando pantalla de bienvenida');

            // Establecer fondo
            if (config.welcomeBackground) {
                welcomeScreen.style.backgroundImage = `url(${config.welcomeBackground})`;
                console.log('‚úÖ Fondo establecido');
            }

            // Mostrar logo si existe
            if (config.eventLogo) {
                eventLogo.src = config.eventLogo;
                eventLogo.style.display = 'block';
                console.log('‚úÖ Logo establecido');
            }

            // Manejar click en toda la pantalla
            welcomeScreen.addEventListener('click', () => {
                console.log('üëÜ Click en la pantalla de bienvenida');
                
                // Aplicar efecto de transici√≥n
                welcomeScreen.classList.add('transition-out');
                
                // Redirigir despu√©s de la animaci√≥n
                setTimeout(() => {
                    window.location.href = 'editor.html';
                }, 400);
            });

            console.log('üéâ === INDEX.HTML INICIALIZADO CORRECTAMENTE ===');
        });
    </script>
</body>
</html>